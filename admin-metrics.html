<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Métricas | Bocaraca</title>

  <link rel="icon" href="./assets/favicon-32x32.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://unpkg.com/lucide@latest"></script>

  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#0d1117">

  <!-- iOS “Add to Home Screen” soporte -->
  <link rel="apple-touch-icon" href="./assets/android-chrome-512x512.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">


  <!-- Estilos existentes -->
  <link rel="stylesheet" href="css/style.css" />

  <!-- Chart.js (gráficas) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* Ajustes mínimos para cards/charts en móvil */
    .metrics-wrap { max-width: 1000px; margin: 0 auto; padding: 0 12px; }
    .cards { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .card {
      background: var(--card-bg, #12171c);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 12px; padding: 12px;
      box-shadow: 0 6px 24px rgba(0,0,0,.25);
    }
    .card h4 { margin: 0 0 6px; font-size: 14px; opacity: .8; }
    .card .big { font-size: 22px; font-weight: 700; }
    .charts { display: grid; gap: 12px; margin-top: 14px; }
    .chart-card { padding: 12px; border-radius: 12px; background: var(--card-bg, #12171c); border:1px solid rgba(255,255,255,.06); }
    .chart-card h3 { margin: 0 0 6px; font-size: 16px; }
    @media(min-width:768px){
      .cards { grid-template-columns: repeat(4,1fr); gap: 12px; }
      .charts { grid-template-columns: 1fr 1fr; }
      .chart-full { grid-column: 1 / -1; }
    }
    .muted { opacity: .7; font-size: 12px; }
    .pill {
      display:inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; margin-left:8px;
      background: #0e3a20; color:#c2ffd8; border:1px solid #1f8a4d;
    }
  </style>
</head>
<body>
<!-- Botón hamburguesa -->
<button id="toggleNav" class="hamburger-btn" aria-label="Menú">
  <i class="bi bi-list"></i>
</button>

<nav id="sidebar" class="sidebar">
    <ul>
      <li><a href="./admin-dashboard.html"><i class="bi bi-house-fill"></i> Inicio</a></li>
      <li><a href="./usuarios.html"><i class="bi bi-people-fill"></i> Usuarios</a></li>
      <li><a href="./control-mensualidades.html"><i class="bi bi-cash-coin"></i> Mensualidades</a></li>
      <li><a href="./admin-users.html"><i class="bi bi-person-rolodex"></i></i> Roles</a></li>
      <li><a href="./marcar-asistencia.html"><i class="bi bi-person-bounding-box"></i> Asistencias</a></li>
      <li><a href="./reportes.html"><i class="bi bi-file-earmark-text-fill"></i> Reportes</a></li>
      <li><a href="./admin-metrics.html"><i class="bi bi-pie-chart-fill"></i></i> Metricas</a></li>
      <li><a href="./admin-events.html"><i class="bi bi-calendar-week"></i>Crear Evento</a></li>
      <li><a href="#" id="logoutSidebar"><i class="bi bi-box-arrow-right"></i> Cerrar sesión</a></li>
    </ul>
</nav>

  <main class="metrics-wrap">
    <h1 style="text-align:center;margin:18px 0 12px;">Panel de métricas</h1>
    <p class="muted" id="lastUpdate" style="text-align:center;"></p>

    <!-- Tarjetas -->
    <section class="cards" id="cards">
      <div class="card"><h4>Usuarios totales</h4><div class="big" id="kpiTotal">—</div></div>
      <div class="card"><h4>Activos</h4><div class="big" id="kpiActivos">—</div></div>
      <div class="card"><h4>Inactivos</h4><div class="big" id="kpiInactivos">—</div></div>
      <div class="card"><h4>Permanencia promedio</h4><div class="big" id="kpiPermanencia">—</div><div class="muted">en meses</div></div>

      <div class="card"><h4>Admins</h4><div class="big" id="kpiAdmins">—</div></div>
      <div class="card"><h4>Profesores</h4><div class="big" id="kpiProfes">—</div></div>
      <div class="card"><h4>Estudiantes</h4><div class="big" id="kpiStudents">—</div></div>
      <div class="card"><h4>Usuarios nuevos 30 días</h4><div class="big" id="kpiNuevos">—</div></div>
    </section>

    <!-- Gráficas -->
    <section class="charts">
      <div class="chart-card">
        <h3>Altas por mes <span class="pill" id="yearBadge"></span></h3>
        <canvas id="signupChart" height="180"></canvas>
      </div>

      <div class="chart-card">
        <h3>Género</h3>
        <canvas id="genderChart" height="180"></canvas>
        <div class="muted" id="genderNote"></div>
      </div>

      <div class="chart-card chart-full">
        <h3>Edades</h3>
        <canvas id="ageChart" height="200"></canvas>
        <div class="muted" id="ageNote"></div>
      </div>
    </section>
  </main>

  <!-- Scripts Firebase (tu patrón de módulos) -->
  <script type="module" src="./js/admin-metrics.js"></script>

    <footer>
        <p>© 2025 <a href="https://github.com/luisillo1cr" target="_blank">luisillo1cr</a>. Todos los derechos reservados.</p>
    </footer>
    
    <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .catch(console.error);
      });
    }
  </script>
</body>
</html>
